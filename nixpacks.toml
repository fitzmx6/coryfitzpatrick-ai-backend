# nixpacks.toml

[phases.setup]
nixPkgs = ["python311"]

[phases.install]
cmds = [
    # 1. Create the Python virtual environment
    "python3.11 -m venv /opt/venv",

    # 2. Upgrade pip and install dependencies
    "/opt/venv/bin/pip install --upgrade pip",
    "/opt/venv/bin/pip install -r requirements.txt",

    # 3. Install the package itself
    "/opt/venv/bin/pip install -e . --no-deps",

    # 4. Prepare vector database
    "/opt/venv/bin/python -m cory_ai_chatbot.prepare_data"
]

[start]
cmd = "bash scripts/start.sh"